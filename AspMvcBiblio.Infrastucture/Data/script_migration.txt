IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
GO

BEGIN TRANSACTION;
GO

CREATE TABLE [Authors] (
    [Id] int NOT NULL IDENTITY,
    [LastName] nvarchar(max) NOT NULL,
    [FirstName] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Authors] PRIMARY KEY ([Id])
);
GO

CREATE TABLE [Books] (
    [Id] int NOT NULL IDENTITY,
    [ISBN] nvarchar(20) NOT NULL,
    [Title] nvarchar(max) NOT NULL,
    [CopiesNumber] int NOT NULL,
    [ServiceDate] datetime2 NOT NULL DEFAULT (getdate()),
    CONSTRAINT [PK_Books] PRIMARY KEY ([Id])
);
GO

CREATE TABLE [Themes] (
    [Id] int NOT NULL IDENTITY,
    [DomainName] nvarchar(50) NOT NULL,
    [Description] nvarchar(2000) NULL,
    CONSTRAINT [PK_Themes] PRIMARY KEY ([Id])
);
GO

CREATE TABLE [AuthorBook] (
    [AuthorsId] int NOT NULL,
    [BooksId] int NOT NULL,
    CONSTRAINT [PK_AuthorBook] PRIMARY KEY ([AuthorsId], [BooksId]),
    CONSTRAINT [FK_AuthorBook_Authors_AuthorsId] FOREIGN KEY ([AuthorsId]) REFERENCES [Authors] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_AuthorBook_Books_BooksId] FOREIGN KEY ([BooksId]) REFERENCES [Books] ([Id]) ON DELETE CASCADE
);
GO

CREATE TABLE [KeyWords] (
    [Id] int NOT NULL IDENTITY,
    [Word] nvarchar(50) NOT NULL,
    [BookId] int NULL,
    CONSTRAINT [PK_KeyWords] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_KeyWords_Books_BookId] FOREIGN KEY ([BookId]) REFERENCES [Books] ([Id])
);
GO

CREATE TABLE [BookTheme] (
    [BooksId] int NOT NULL,
    [ThemesId] int NOT NULL,
    CONSTRAINT [PK_BookTheme] PRIMARY KEY ([BooksId], [ThemesId]),
    CONSTRAINT [FK_BookTheme_Books_BooksId] FOREIGN KEY ([BooksId]) REFERENCES [Books] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_BookTheme_Themes_ThemesId] FOREIGN KEY ([ThemesId]) REFERENCES [Themes] ([Id]) ON DELETE CASCADE
);
GO

IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'FirstName', N'LastName') AND [object_id] = OBJECT_ID(N'[Authors]'))
    SET IDENTITY_INSERT [Authors] ON;
INSERT INTO [Authors] ([Id], [FirstName], [LastName])
VALUES (1, N'Jane', N'Austen');
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'FirstName', N'LastName') AND [object_id] = OBJECT_ID(N'[Authors]'))
    SET IDENTITY_INSERT [Authors] OFF;
GO

IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'CopiesNumber', N'ISBN', N'ServiceDate', N'Title') AND [object_id] = OBJECT_ID(N'[Books]'))
    SET IDENTITY_INSERT [Books] ON;
INSERT INTO [Books] ([Id], [CopiesNumber], [ISBN], [ServiceDate], [Title])
VALUES (1, 1, N'2-7654-1005-4', '2012-09-01T00:00:00.0000000', N'Orgueil et Préjugés');
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'CopiesNumber', N'ISBN', N'ServiceDate', N'Title') AND [object_id] = OBJECT_ID(N'[Books]'))
    SET IDENTITY_INSERT [Books] OFF;
GO

IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'BookId', N'Word') AND [object_id] = OBJECT_ID(N'[KeyWords]'))
    SET IDENTITY_INSERT [KeyWords] ON;
INSERT INTO [KeyWords] ([Id], [BookId], [Word])
VALUES (1, NULL, N'mariage');
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'BookId', N'Word') AND [object_id] = OBJECT_ID(N'[KeyWords]'))
    SET IDENTITY_INSERT [KeyWords] OFF;
GO

IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Description', N'DomainName') AND [object_id] = OBJECT_ID(N'[Themes]'))
    SET IDENTITY_INSERT [Themes] ON;
INSERT INTO [Themes] ([Id], [Description], [DomainName])
VALUES (1, N'Les livres de suspense sont des thrillers qui tiennent les lecteurs en haleine jusqu''à la fin. Ils ont souvent des intrigues complexes, des personnages intrigants et des rebondissements inattendus. "Gone Girl" de Gillian Flynn est un exemple de livre de suspense qui raconte l''histoire d''un mari qui devient le suspect principal dans la disparition de sa femme', N'Suspense '),
(2, N'Les biographies sont des livres qui racontent la vie d''une personne réelle. Ils peuvent se concentrer sur la vie entière de la personne ou sur une période spécifique de sa vie. Les biographies sont souvent utilisées pour en apprendre davantage sur des personnalités célèbres telles que des musiciens, des acteurs ou des politiciens. "Steve Jobs" de Walter Isaacson est un exemple de biographie bien connue.', N'Biographie '),
(3, N'Les livres de fantasy sont des histoires qui se déroulent dans des mondes imaginaires remplis de magie et de créatures fantastiques. Ils peuvent se concentrer sur des aventures, des quêtes ou des batailles épiques. "Le Seigneur des Anneaux" de J.R.R. Tolkien est un exemple bien connu de livre de fantasy.', N'Fantasy'),
(4, N'Les livres de romance sont des histoires d''amour passionnantes et souvent dramatiques. Ils peuvent se concentrer sur des relations amoureuses, des triangles amoureux et des obstacles à surmonter. "Orgueil et Préjugés" de Jane Austen est un exemple classique de livre de romance.', N'Romance '),
(5, N'Les livres policiers sont des histoires qui se concentrent sur les enquêtes et les résolutions de crimes. Les auteurs de livres policiers doivent créer des intrigues compliquées et des personnages convaincants pour garder les lecteurs captivés. "Le Silence des Agneaux" de Thomas Harris est un exemple célèbre de livre policier.', N'Policier '),
(6, N'Les autobiographies sont des livres qui racontent la vie d''une personne écrite par elle-même. Ils peuvent se concentrer sur des moments clés de la vie de l''auteur, des leçons apprises ou des défis surmontés. "Born a Crime" de Trevor Noah est un exemple récent de livre autobiographique qui raconte l''histoire de l''humoriste et présentateur sud-africain.', N'Autobiographie ');
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Description', N'DomainName') AND [object_id] = OBJECT_ID(N'[Themes]'))
    SET IDENTITY_INSERT [Themes] OFF;
GO

CREATE INDEX [IX_AuthorBook_BooksId] ON [AuthorBook] ([BooksId]);
GO

CREATE INDEX [IX_BookTheme_ThemesId] ON [BookTheme] ([ThemesId]);
GO

CREATE INDEX [IX_KeyWords_BookId] ON [KeyWords] ([BookId]);
GO

INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20230425093641_BibliothequeVersionLilian1', N'6.0.16');
GO

COMMIT;
GO

BEGIN TRANSACTION;
GO

IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'AuthorsId', N'BooksId') AND [object_id] = OBJECT_ID(N'[AuthorBook]'))
    SET IDENTITY_INSERT [AuthorBook] ON;
INSERT INTO [AuthorBook] ([AuthorsId], [BooksId])
VALUES (1, 1);
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'AuthorsId', N'BooksId') AND [object_id] = OBJECT_ID(N'[AuthorBook]'))
    SET IDENTITY_INSERT [AuthorBook] OFF;
GO

INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20230425102519_BibliothequeVersionLilian2', N'6.0.16');
GO

COMMIT;
GO

BEGIN TRANSACTION;
GO

CREATE TABLE [Readers] (
    [Id] int NOT NULL IDENTITY,
    [LastName] nvarchar(max) NOT NULL,
    [FirstName] nvarchar(max) NOT NULL,
    [Email] nvarchar(max) NOT NULL,
    [Phone] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Readers] PRIMARY KEY ([Id])
);
GO

IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Email', N'FirstName', N'LastName', N'Phone') AND [object_id] = OBJECT_ID(N'[Readers]'))
    SET IDENTITY_INSERT [Readers] ON;
INSERT INTO [Readers] ([Id], [Email], [FirstName], [LastName], [Phone])
VALUES (1, N'Ermane.Pourmohtasham@mail.com', N'Ermane', N'Pourmohtasham', N'0606060606');
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Email', N'FirstName', N'LastName', N'Phone') AND [object_id] = OBJECT_ID(N'[Readers]'))
    SET IDENTITY_INSERT [Readers] OFF;
GO

IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Email', N'FirstName', N'LastName', N'Phone') AND [object_id] = OBJECT_ID(N'[Readers]'))
    SET IDENTITY_INSERT [Readers] ON;
INSERT INTO [Readers] ([Id], [Email], [FirstName], [LastName], [Phone])
VALUES (2, N'Jean.Valjean@mail.com', N'Jean', N'Valjean', N'0676869616');
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Email', N'FirstName', N'LastName', N'Phone') AND [object_id] = OBJECT_ID(N'[Readers]'))
    SET IDENTITY_INSERT [Readers] OFF;
GO

INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20230515080927_BibliothequeReaderMVC1', N'6.0.16');
GO

COMMIT;
GO

BEGIN TRANSACTION;
GO

IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'BooksId', N'ThemesId') AND [object_id] = OBJECT_ID(N'[BookTheme]'))
    SET IDENTITY_INSERT [BookTheme] ON;
INSERT INTO [BookTheme] ([BooksId], [ThemesId])
VALUES (1, 1);
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'BooksId', N'ThemesId') AND [object_id] = OBJECT_ID(N'[BookTheme]'))
    SET IDENTITY_INSERT [BookTheme] OFF;
GO

INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20230515090650_BibliothequeReaderMVC2', N'6.0.16');
GO

COMMIT;
GO

BEGIN TRANSACTION;
GO

ALTER TABLE [KeyWords] DROP CONSTRAINT [FK_KeyWords_Books_BookId];
GO

DROP INDEX [IX_KeyWords_BookId] ON [KeyWords];
GO

DECLARE @var0 sysname;
SELECT @var0 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[KeyWords]') AND [c].[name] = N'BookId');
IF @var0 IS NOT NULL EXEC(N'ALTER TABLE [KeyWords] DROP CONSTRAINT [' + @var0 + '];');
ALTER TABLE [KeyWords] DROP COLUMN [BookId];
GO

CREATE TABLE [BookKeyword] (
    [BooksId] int NOT NULL,
    [KeyWordsId] int NOT NULL,
    CONSTRAINT [PK_BookKeyword] PRIMARY KEY ([BooksId], [KeyWordsId]),
    CONSTRAINT [FK_BookKeyword_Books_BooksId] FOREIGN KEY ([BooksId]) REFERENCES [Books] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_BookKeyword_KeyWords_KeyWordsId] FOREIGN KEY ([KeyWordsId]) REFERENCES [KeyWords] ([Id]) ON DELETE CASCADE
);
GO

IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Word') AND [object_id] = OBJECT_ID(N'[KeyWords]'))
    SET IDENTITY_INSERT [KeyWords] ON;
INSERT INTO [KeyWords] ([Id], [Word])
VALUES (2, N'meurtre');
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Word') AND [object_id] = OBJECT_ID(N'[KeyWords]'))
    SET IDENTITY_INSERT [KeyWords] OFF;
GO

IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Word') AND [object_id] = OBJECT_ID(N'[KeyWords]'))
    SET IDENTITY_INSERT [KeyWords] ON;
INSERT INTO [KeyWords] ([Id], [Word])
VALUES (3, N'été');
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Word') AND [object_id] = OBJECT_ID(N'[KeyWords]'))
    SET IDENTITY_INSERT [KeyWords] OFF;
GO

IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Word') AND [object_id] = OBJECT_ID(N'[KeyWords]'))
    SET IDENTITY_INSERT [KeyWords] ON;
INSERT INTO [KeyWords] ([Id], [Word])
VALUES (4, N'voyage');
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Word') AND [object_id] = OBJECT_ID(N'[KeyWords]'))
    SET IDENTITY_INSERT [KeyWords] OFF;
GO

IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'BooksId', N'KeyWordsId') AND [object_id] = OBJECT_ID(N'[BookKeyword]'))
    SET IDENTITY_INSERT [BookKeyword] ON;
INSERT INTO [BookKeyword] ([BooksId], [KeyWordsId])
VALUES (1, 2);
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'BooksId', N'KeyWordsId') AND [object_id] = OBJECT_ID(N'[BookKeyword]'))
    SET IDENTITY_INSERT [BookKeyword] OFF;
GO

CREATE INDEX [IX_BookKeyword_KeyWordsId] ON [BookKeyword] ([KeyWordsId]);
GO

INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20230515092559_BibliothequeKeywords1', N'6.0.16');
GO

COMMIT;
GO

